<!DOCTYPE html>
<html>

  <head>

    <title>GIT + Rails + Rcov + Jenkins = Continuous Integration</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Code and Origami – Software Engineering" />

    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="code 'n fold" />
    <meta property="og:title" content="GIT + Rails + Rcov + Jenkins = Continuous Integration" />
    <meta property="og:description" content="Code and Origami – Software Engineering" />
    <meta property="og:url" content="http://www.code-n-fold.com/programming/2012/04/24/git-rails-rcov-jenkins-super-simple-ci-continuous-integration.html" />
    <meta property="og:image" content="http://www.code-n-fold.com/images/" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="GIT + Rails + Rcov + Jenkins = Continuous Integration" />
    <meta name="twitter:url" content="http://www.code-n-fold.com/programming/2012/04/24/git-rails-rcov-jenkins-super-simple-ci-continuous-integration.html" />
    <meta name="twitter:image" content="http://www.code-n-fold.com/images/" />
    <meta name="twitter:site" content="@code_n_fold" />
    <meta name="twitter:creator" content="@code_n_fold" />
    
    <meta name="twitter:description" content="Code and Origami – Software Engineering">
    
    


    <link rel="alternate" href="http://www.code-n-fold.com/feed.xml" type="application/rss+xml" title="GIT + Rails + Rcov + Jenkins = Continuous Integration" />
    <link rel="canonical" href="/programming/2012/04/24/git-rails-rcov-jenkins-super-simple-ci-continuous-integration.html" />

    <link rel="stylesheet" href="/assets/normalize.css" />
    <link rel="stylesheet" href="/assets/animate.css" />
    <link rel="stylesheet" href="/assets/styles.css" />
    <link rel="stylesheet" href="/assets/custom.css" />

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-66459836-1', 'auto');
        ga('send', 'pageview');
      </script>
    

  </head>

  <body>

    <header data-animation="fadeInDownBig">

      <a href="/" title="Back to Homepage" class="logo">code <i>'n</i> fold</a>

      
      

      <button class="toggle">Menu</button>
      <nav>
        <ul>
          <li><a href="/" title="Home">Home</a></li>
          
            
          
            
          
            
          
            
          
            
          
            
              <li><a href="/about.html" title="About">About</a></li>
            
          
            
              <li><a href="/projects.html" title="Projects">Projects</a></li>
            
          
            
              <li><a href="/archive/" title="Archive">Archive</a></li>
            
          
            
              <li><a href="/categories.html" title="Categories">Categories</a></li>
            
          

        <hr/>

          
            
              <li><a href="/tools/2011/11/28/convert-mysql-dump-to-sqlite-format.html" title="MySQL 2 SQLite">MySQL 2 SQLite</a></li>
            
          
            
              <li><a href="/sql/2012/04/12/fix-wrong-utf-8-encodings-in-mysql-table.html" title="Fix MySQL UTF-8 encoding">Fix MySQL UTF-8 encoding</a></li>
            
          
            
              <li><a href="/deployment/2012/06/25/secure-your-staging-environments-with-capistrano-and-htaccess.html" title="Capistrano and .htaccess">Capistrano and .htaccess</a></li>
            
          
            
              <li><a href="/projects/2012/08/16/git-flow-cheatsheet.html" title="Git flow cheatsheet">Git flow cheatsheet</a></li>
            
          
        </ul>
      </nav>

    </header>



	


<section class="content">

	<article>

		<header class="gradient-1" data-animation="fadeInDownBig">

			

<div class="excerpt">

  
    <span class="title">3 minutes</span>
  

	

		
			<h1><a href="/programming/2012/04/24/git-rails-rcov-jenkins-super-simple-ci-continuous-integration.html" title="GIT + Rails + Rcov + Jenkins = Continuous Integration">GIT + Rails + Rcov + Jenkins = Continuous Integration</a></h1>
		


	

	<p>Simple and easy to configure continuous integration environment</p>

	

		

			<span class="meta">Published <b>Apr 24, 2012</b>

        
          in <b>programming</b>
        

        
          with tags:
        

        
          <a class="tag" href="/tags/ci">ci</a>
        
          <a class="tag" href="/tags/git-hooks">git hooks</a>
        
          <a class="tag" href="/tags/hudson">hudson</a>
        
          <a class="tag" href="/tags/rails">rails</a>
        
          <a class="tag" href="/tags/rcov">rcov</a>
        
      </span>

		

	

</div>


	<a href="#" title="Scroll" class="scroll">Scroll</a>



		</header>

		<div class="body" data-animation="fadeInUp">

			<p>Let’s set up a <strong>simple and easy</strong> to configure continuous integration environment to <strong>run automated tests and generate coverage reports</strong> for our code.</p>

<p>The setup consists of three steps. In the end we’ll have an automated setup which requires no further steps to use it!</p>

<h2 id="initial-situation">Initial Situation</h2>

<p>We have a <a href="https://rubyonrails.org/">Ruby on Rails</a> project under <a href="https://git-scm.com/">GIT</a> source control on which we want to run tests and generate coverage reports using <a href="https://jenkins-ci.org/">Jenkins</a>.</p>

<p>The repository consists of several branches, but the main (and interesing) branches are <strong>development</strong>, <strong>staging</strong> and <strong>master</strong>.</p>

<p>Tests and coverage reports should be generated for the <strong>staging</strong> and <strong>master</strong> branches every time something is commited into them.</p>

<p>So far so good, let’s get started.</p>

<h2 id="prerequirements">Prerequirements</h2>

<p>I’m assuming that you already have the following environment up and running, If not - well…</p>

<ul>
  <li>A RoR project hosted on a central GIT repository</li>
  <li>A GIT repository server (it also works without one, but this is the preferred setup and we’re using hooks so you must be able to edit them)</li>
  <li>A Jenkins build server (with git and ruby running) and the following plugins installed
<a href="https://wiki.hudson-ci.org/display/HUDSON/Ruby+Plugin">Hudson ruby plugin</a>,
<a href="https://wiki.jenkins-ci.org/display/JENKINS/Rake+Plugin">Jenkins Rake plugin</a>,
<a href="https://wiki.jenkins-ci.org/display/JENKINS/Ruby+Metrics+Plugin">Jenkins ruby metrics plugin</a>,
<a href="https://wiki.jenkins-ci.org/display/JENKINS/Git+Plugin">Jenkins GIT plugin</a></li>
</ul>

<h2 id="st---configure-the-build-job">1st - Configure the build job</h2>

<p>I suggest you include the rcov gem in your Gemfile under the test group to assure it’s getting installed on the build server. If you don’t want to, install the gem on your build server.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
  <span class="n">gem</span> <span class="s1">&#39;rcov&#39;</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">end</span></code></pre></div>

<p>Create a new jenkins <strong>build job</strong> for your project and configure it.</p>

<ul>
  <li>Select <strong>Git</strong> under Source-Code-Management and add your build branches. In your case they would be <strong>staging</strong> and <strong>master</strong></li>
  <li>Add <strong>execute shell</strong> as build step and paste the following script, adjust the steps as you see fit for your case</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># setup env</span>
<span class="nb">export </span><span class="nv">RAILS_ENV</span><span class="o">=</span><span class="nb">test</span>

<span class="c"># Prepare for rcov</span>
<span class="o">[</span> -d <span class="p">&amp;</span>quot<span class="p">;</span>coverage<span class="p">&amp;</span>quot<span class="p">;</span> <span class="o">]</span> <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> rm -rf coverage
mkdir coverage

<span class="c"># install bundle</span>
bundle install --deployment --without development

<span class="c"># prepare database</span>
mv config/database.example.yml config/database.yml
bundle <span class="nb">exec </span>rake db:drop
bundle <span class="nb">exec </span>rake db:create
bundle <span class="nb">exec </span>rake db:schema:load
bundle <span class="nb">exec </span>rake db:seed

<span class="c"># run tests and coverage</span>
bundle <span class="nb">exec </span>rake <span class="nb">test</span>
bundle <span class="nb">exec </span>rake rcov</code></pre></div>

<ul>
  <li>Check the <strong>Publish Rcov report option under **post-build-actions</strong> and set the <strong>Rcov report directory</strong> to <strong>coverage</strong>. Adjust the Coverage metric targets as desired but the default values are a good start.</li>
</ul>

<p>That’s it for the basic jenkins job configuration, you can of course define other options as well, I for example use e-mail notifications as well.</p>

<h2 id="nd---configure-git-hook-for-to-trigger-build-process">2nd - Configure git hook for to trigger build process</h2>

<p>Now, I want my build job to be triggered every time I merge into the staging or master branch. To achieve this I’m using the git <strong>post-update</strong> hook. You can, of course use the hook on your local machine without using a central GIT server. It suffices if you’re working alone or simply can’t edit GIT hooks on your repository server (which is a sad thing).</p>

<p>But let’s assume we have a central GIT server, so add the following script as <strong>post-update</strong> hook on your git server. The hooks are located in the git repository directory under <strong>your-repository/hooks/post-update.</strong> You can simply replace the file located there, important is the filename <strong>post-update</strong>.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="c"># trigger jenkins build after post-update into specific branch</span>
<span class="c">#stages=&#39;staging|master&#39;</span>
<span class="c">#if [[ `git rev-parse --abbrev-ref HEAD` =~ $stages ]]; then</span>
	curl https://hudson.yourdomain.com/job/Your-Job/build?delay<span class="o">=</span>0sec
<span class="c">#fi</span></code></pre></div>

<p>Finally, the hook must be marked as executable, else it won’t work:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">chmod +x post-update</code></pre></div>

<p>And this part’s done too!</p>

<h2 id="rd---develop-merge-push">3rd - Develop, merge, push</h2>

<p>The setup is complete, every time something ist commited into the staging or master branch and pushed to the GIT server your jenkins job gets triggered which in turn runs your tests and generates rcov coverage reports.</p>


		</div>

		<footer>

			

  <div class="meta">

    <div class="author" data-animation="fadeInUp">
                  
      <span class="title">Written by</span>

      <h4>Daniel Kummer</h4>
      <p>I'm a software engineer who also enjoys lots of other things like diving, tinkering, photography, whiskey and much more...</p>

      
        <ul>
          <li><a href="https://twitter.com/code_n_fold" title="Twitter" class="icon twitter">Twitter</a></li>
          <li><a href="https://www.facebook.com/daniel.kummer" title="Facebook" class="icon facebook">Facebook</a></li>
          
          <li><a href="https://www.linkedin.com/pub/daniel-kummer/58/344/528" title="LinkedIn" class="icon linkedin">LinkedIn</a></li>
          
          
          
          <li><a href="feed://code-n-fold.com/feed.xml" title="RSS" class="icon rss">RSS</a></li>
        </ul>
      

    </div>

    <div class="share" data-animation="fadeInUp">
                  
      <span class="title">Share</span>

      <ul>
        <li><a href="https://twitter.com/home?status=Code%20and%20Origami%20%E2%80%93%20Software%20Engineering%20http://www.code-n-fold.com/programming/2012/04/24/git-rails-rcov-jenkins-super-simple-ci-continuous-integration.html" title="Tweet" class="icon twitter">Tweet</a></li>
        <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://www.code-n-fold.com/programming/2012/04/24/git-rails-rcov-jenkins-super-simple-ci-continuous-integration.html" title="Like" class="icon facebook">Like</a></li>
        <li><a href="https://plus.google.com/share?url=http://www.code-n-fold.com/programming/2012/04/24/git-rails-rcov-jenkins-super-simple-ci-continuous-integration.html" title="+1" class="icon google">+1</a></li>
      </ul>

    </div>

  </div>



			
  <div class="comments" data-animation="fadeInUp">
    
    <span class="title">Comments</span>
    <div id="disqus_thread"></div>

    <script type="text/javascript">
      var disqus_shortname = 'code-n-fold';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>

    <noscript>
      Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>

  </div>


			

	<div class="pagination" data-animation="fadeInUp">
		<a href="/programming/2012/04/21/rails-3-1-devise_for-breaks-dbmigrate-fix-6.html" title="View Older Posts" class="button older">Older</a>
		<a href="/projects/2012/06/05/skills-my-latest-project.html" title="View Newer Posts" class="button newer">Newer</a>
	</div>





		</footer>

	</article>

</section>



	
		
	

	
		
	

	<section class="teaser gradient-1" data-animation="fadeInUp">
	      
		<div class="excerpt">
	            
			<span class="title">less than 1 minute</span>

			
				<h1><a href="/programming/2012/04/21/rails-3-1-devise_for-breaks-dbmigrate-fix-6.html" title="Rails 3.1 devise_for breaks db:migrate - fix">Rails 3.1 devise_for breaks db:migrate - fix</a></h1>
			

			<p>Maybe you've encountered this incredible annoying devise bug which prevents you from successfully running rake tasks like db:migrate, db:schema:load and so on..</p>

			
				<span class="meta">Published <b>Apr 21, 2012</b> in <b>programming</b></span>
			

		</div>

	</section>



    

      <footer data-animation="fadeInUp">
        <div class="copyright">
          <b>Copyright 2015 Daniel Kummer.</b> All Rights Reserved.
        	<a href="mailto:daniel.kummer@gmail.com" title="Send E-Mail">Contact</a>
        	<a href="/feed.xml" title="Subscribe to Feed">RSS</a>
        </div>
      </footer>
      
    

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Daniel Kummer",
      "url" : "http://www.code-n-fold.com",
      "sameAs" : [ "http://www.facebook.com/daniel.kummer",
        "http://www.twitter.com/code_n_fold"]
    }
    </script>
    
    <script src="/assets/jquery-2.1.1.min.js"></script>
    <script src="/assets/viewportchecker.js"></script>
    <script src="/assets/scripts.js"></script>

  </body>

</html>
