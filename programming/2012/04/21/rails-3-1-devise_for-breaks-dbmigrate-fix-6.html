<!DOCTYPE html>
<html>

  <head>

    <title>Rails 3.1 devise_for breaks db:migrate - fix</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Code and Origami – Software Engineering" />

    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="code 'n fold" />
    <meta property="og:title" content="Rails 3.1 devise_for breaks db:migrate - fix" />
    <meta property="og:description" content="Code and Origami – Software Engineering" />
    <meta property="og:url" content="http://www.code-n-fold.com/programming/2012/04/21/rails-3-1-devise_for-breaks-dbmigrate-fix-6.html" />
    <meta property="og:image" content="http://www.code-n-fold.com/images/" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Rails 3.1 devise_for breaks db:migrate - fix" />
    <meta name="twitter:url" content="http://www.code-n-fold.com/programming/2012/04/21/rails-3-1-devise_for-breaks-dbmigrate-fix-6.html" />
    <meta name="twitter:image" content="http://www.code-n-fold.com/images/" />
    <meta name="twitter:site" content="@code_n_fold" />
    <meta name="twitter:creator" content="@code_n_fold" />
    
    <meta name="twitter:description" content="Code and Origami – Software Engineering">
    
    


    <link rel="alternate" href="http://www.code-n-fold.com/feed.xml" type="application/rss+xml" title="Rails 3.1 devise_for breaks db:migrate - fix" />
    <link rel="canonical" href="/programming/2012/04/21/rails-3-1-devise_for-breaks-dbmigrate-fix-6.html" />

    <link rel="stylesheet" href="/assets/normalize.css" />
    <link rel="stylesheet" href="/assets/animate.css" />
    <link rel="stylesheet" href="/assets/styles.css" />
    <link rel="stylesheet" href="/assets/custom.css" />

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-66459836-1', 'auto');
        ga('send', 'pageview');
      </script>
    

  </head>

  <body>

    <header data-animation="fadeInDownBig">

      <a href="/" title="Back to Homepage" class="logo">code <i>'n</i> fold</a>

      
      

      <button class="toggle">Menu</button>
      <nav>
        <ul>
          <li><a href="/" title="Home">Home</a></li>
          
            
          
            
          
            
          
            
          
            
          
            
              <li><a href="/about.html" title="About">About</a></li>
            
          
            
              <li><a href="/projects.html" title="Projects">Projects</a></li>
            
          
            
              <li><a href="/archive/" title="Archive">Archive</a></li>
            
          
            
              <li><a href="/categories.html" title="Categories">Categories</a></li>
            
          

        <hr/>

          
            
              <li><a href="/tools/2011/11/28/convert-mysql-dump-to-sqlite-format.html" title="MySQL 2 SQLite">MySQL 2 SQLite</a></li>
            
          
            
              <li><a href="/sql/2012/04/12/fix-wrong-utf-8-encodings-in-mysql-table.html" title="Fix MySQL UTF-8 encoding">Fix MySQL UTF-8 encoding</a></li>
            
          
            
              <li><a href="/deployment/2012/06/25/secure-your-staging-environments-with-capistrano-and-htaccess.html" title="Capistrano and .htaccess">Capistrano and .htaccess</a></li>
            
          
            
              <li><a href="/projects/2012/08/16/git-flow-cheatsheet.html" title="Git flow cheatsheet">Git flow cheatsheet</a></li>
            
          
        </ul>
      </nav>

    </header>



	


<section class="content">

	<article>

		<header class="gradient-1" data-animation="fadeInDownBig">

			

<div class="excerpt">

  
    <span class="title">less than 1 minute</span>
  

	

		
			<h1><a href="/programming/2012/04/21/rails-3-1-devise_for-breaks-dbmigrate-fix-6.html" title="Rails 3.1 devise_for breaks db:migrate - fix">Rails 3.1 devise_for breaks db:migrate - fix</a></h1>
		


	

	<p>Maybe you've encountered this incredible annoying devise bug which prevents you from successfully running rake tasks like db:migrate, db:schema:load and so on..</p>

	

		

			<span class="meta">Published <b>Apr 21, 2012</b>

        
          in <b>programming</b>
        

        
          with tags:
        

        
          <a class="tag" href="/tags/devise">devise</a>
        
          <a class="tag" href="/tags/rails">rails</a>
        
      </span>

		

	

</div>


	<a href="#" title="Scroll" class="scroll">Scroll</a>



		</header>

		<div class="body" data-animation="fadeInUp">

			<p>The generated error is always the same:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">Devise error: ActiveRecord::StatementInvalid: Mysql2::Error: Table <span class="s1">&#39;skills.users&#39;</span> doesn<span class="err">&#39;</span>t exist: SHOW FIELDS FROM <span class="sb">`</span>users<span class="sb">`</span></code></pre></div>

<p>Sadly it’s a chicken and egg problem, the root of the problem is a small, simple line in your routes.rb file:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">devise_for</span> <span class="ss">:users</span></code></pre></div>

<p>I came to understand it has something to do with user model class methods and scopes which access the user model itself. When migrating devise scans the user model and tries something ( I regret to say I have no idea what…) but the table obviously doen’t exist yet. The only working solution (pretty ugly but working though) is simply catching any exception generated by the <strong>devise_for</strong> statement:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">begin</span>
    <span class="n">devise_for</span> <span class="ss">:users</span>
  <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="no">Devise</span> <span class="ss">error</span><span class="p">:</span> <span class="c1">#{e.class}: #{e}&amp;quot;</span>
  <span class="k">end</span></code></pre></div>

<p>If anyone knows the real root of the problem and the ultimate, beautiful solution don’t hesitate and provide!</p>


		</div>

		<footer>

			

  <div class="meta">

    <div class="author" data-animation="fadeInUp">
                  
      <span class="title">Written by</span>

      <h4>Daniel Kummer</h4>
      <p>I'm a software engineer who also enjoys lots of other things like diving, tinkering, photography, whiskey and much more...</p>

      
        <ul>
          <li><a href="https://twitter.com/code_n_fold" title="Twitter" class="icon twitter">Twitter</a></li>
          <li><a href="https://www.facebook.com/daniel.kummer" title="Facebook" class="icon facebook">Facebook</a></li>
          
          <li><a href="https://www.linkedin.com/pub/daniel-kummer/58/344/528" title="LinkedIn" class="icon linkedin">LinkedIn</a></li>
          
          
          
          <li><a href="feed://code-n-fold.com/feed.xml" title="RSS" class="icon rss">RSS</a></li>
        </ul>
      

    </div>

    <div class="share" data-animation="fadeInUp">
                  
      <span class="title">Share</span>

      <ul>
        <li><a href="https://twitter.com/home?status=Code%20and%20Origami%20%E2%80%93%20Software%20Engineering%20http://www.code-n-fold.com/programming/2012/04/21/rails-3-1-devise_for-breaks-dbmigrate-fix-6.html" title="Tweet" class="icon twitter">Tweet</a></li>
        <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://www.code-n-fold.com/programming/2012/04/21/rails-3-1-devise_for-breaks-dbmigrate-fix-6.html" title="Like" class="icon facebook">Like</a></li>
        <li><a href="https://plus.google.com/share?url=http://www.code-n-fold.com/programming/2012/04/21/rails-3-1-devise_for-breaks-dbmigrate-fix-6.html" title="+1" class="icon google">+1</a></li>
      </ul>

    </div>

  </div>



			
  <div class="comments" data-animation="fadeInUp">
    
    <span class="title">Comments</span>
    <div id="disqus_thread"></div>

    <script type="text/javascript">
      var disqus_shortname = 'code-n-fold';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>

    <noscript>
      Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>

  </div>


			

	<div class="pagination" data-animation="fadeInUp">
		<a href="/programming/2012/04/20/install-node-js-on-centos-5-5.html" title="View Older Posts" class="button older">Older</a>
		<a href="/programming/2012/04/24/git-rails-rcov-jenkins-super-simple-ci-continuous-integration.html" title="View Newer Posts" class="button newer">Newer</a>
	</div>





		</footer>

	</article>

</section>



	
		
	

	
		
	

	<section class="teaser gradient-1" data-animation="fadeInUp">
	      
		<div class="excerpt">
	            
			<span class="title">less than 1 minute</span>

			
				<h1><a href="/programming/2012/04/20/install-node-js-on-centos-5-5.html" title="Install Node.js on Centos 5.5">Install Node.js on Centos 5.5</a></h1>
			

			<p>How to install node.js on Centos 5.5 Server?</p>

			
				<span class="meta">Published <b>Apr 20, 2012</b> in <b>programming</b></span>
			

		</div>

	</section>



    

      <footer data-animation="fadeInUp">
        <div class="copyright">
          <b>Copyright 2015 Daniel Kummer.</b> All Rights Reserved.
        	<a href="mailto:daniel.kummer@gmail.com" title="Send E-Mail">Contact</a>
        	<a href="/feed.xml" title="Subscribe to Feed">RSS</a>
        </div>
      </footer>
      
    

    <script type="application/ld+json">
    { "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Daniel Kummer",
      "url" : "http://www.code-n-fold.com",
      "sameAs" : [ "http://www.facebook.com/daniel.kummer",
        "http://www.twitter.com/code_n_fold"]
    }
    </script>
    
    <script src="/assets/jquery-2.1.1.min.js"></script>
    <script src="/assets/viewportchecker.js"></script>
    <script src="/assets/scripts.js"></script>

  </body>

</html>
