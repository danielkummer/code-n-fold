---
layout: default
title: MySQL 2 SQLite
date: 2011-11-28 14:15:38.000000000 +01:00
categories:
- Bash
tags:
- bash
- mysql
- sql
- sqlite
status: publish
type: post
excerpt: Convert a MySQL table to SQLite
navigation: true
---
<p><a href="https://codenfold.files.wordpress.com/2011/11/595516_77629978.jpg"><img class="alignright size-thumbnail wp-image-51" title="Convert" src="assets/595516_77629978.jpg?w=150" alt="Convert" width="150" height="132" /></a><br />
Maybe you know the situation: you have a mysql database filled with some data which you'd like to use in a sqlite database. Sadly, you can't simply use MySQL syntax to create tables and add data to your sqlite database, the syntax doesn't match.</p>
<p>This is where this little bash script comes in handy. Just pass the mysql dump file as parameter to the script and you'll get a sqlite compatible output.</p>
<p>[sourcecode language="bash"]<br />
./mysqldump2sqlite3.sh mydumpfile.sql<br />
[/sourcecode]</p>
<p>This is quite handy if you want to extract some data from a productive MySQL database and use it in a testing environment sqlite database for example.</p>
<p>[sourcecode language="bash" collapse="true"]<br />
#!/bin/sh</p>
<p>if [ &quot;$#&quot; -lt 1 ]; then<br />
   echo &quot;Usage: $0 &quot;<br />
   exit<br />
fi</p>
<p>SRC=$1<br />
DST=$1.sqlite3.sql<br />
DB=$1.sqlite3.db<br />
ERR=$1.sqlite3.err</p>
<p>cat $SRC |<br />
grep -v ' KEY &quot;' |<br />
grep -v ' UNIQUE KEY &quot;' |<br />
grep -v ' PRIMARY KEY ' |</p>
<p>sed 's/ENGINE=MyISAM/ /g' |<br />
sed 's/DEFAULT/ /g' |<br />
sed 's/CHARSET=[a-zA-Z0-9]*/ /g' |<br />
sed 's/AUTO_INCREMENT=[0-9]*/ /g' |</p>
<p>sed 's/\\r\\n/\\n/g' |<br />
sed 's/\\&quot;/&quot;/g' |<br />
sed '/^SET/d' |<br />
sed 's/ unsigned / /g' |<br />
sed 's/ auto_increment/ primary key autoincrement/g' |<br />
sed 's/ smallint([0-9]*) / integer /g' |<br />
sed 's/ tinyint([0-9]*) / integer /g' |<br />
sed 's/ int([0-9]*) / integer /g' |<br />
sed 's/ character set [^ ]* / /g' |<br />
sed 's/ enum([^)]*) / varchar(255) /g' |<br />
sed 's/ on update [^,]*//g' |<br />
sed 's/UNLOCK TABLES;//g' |<br />
sed 's/LOCK TABLES [^;]*;//g' |<br />
perl -e 'local $/;$_=&lt;&gt;;s/,\n\)/\n\)/gs;print &quot;begin;\n&quot;;print;print &quot;commit;\n&quot;' |<br />
perl -pe '<br />
  if (/^(INSERT.+?)\(/) {<br />
     $a=$1;<br />
     s/\\'\''/'\'\''/g;<br />
     s/\\n/\n/g;<br />
     s/\),\(/\);\n$a\(/g;<br />
  }<br />
  ' &gt; $DST</p>
<p>cat $DST | sqlite3 $DB &gt; $ERR</p>
<p>ERRORS=`cat $ERR | wc -l`</p>
<p>if [ &quot;$ERRORS&quot; -eq &quot;0&quot; ]; then<br />
	echo &quot;Conversion completed without error. Your db is ready under: $DB&quot;<br />
	echo &quot;\$ sqlite3 $DB&quot;<br />
  rm -f $ERR<br />
else<br />
   echo &quot;There were errors during conversion. \<br />
	Please review $ERR and $DST for details.&quot;<br />
fi<br />
[/sourcecode]</p>
