---
layout: default
title: Rails 3.1 devise_for breaks db:migrate - fix
date: 2012-04-21 17:05:05.000000000 +02:00
categories:
- Coding
- Rails
tags:
- bug
- db:migrate
- devise
- devise_for
- rails
status: publish
type: post
published: true
meta:
  _edit_last: '29044201'
  _wpas_skip_twitter: '1'

---
<p>Maybe you've encountered this incredible annoying devise bug which prevents you from successfully running rake tasks like db:migrate, db:schema:load and so on..</p>
<p>The generated error is always the same:</p>
<p>[code]<br />
Devise error: ActiveRecord::StatementInvalid: Mysql2::Error: Table 'skills.users' doesn't exist: SHOW FIELDS FROM `users`<br />
[/code]</p>
<p>Sadly it's a chicken and egg problem, the root of the problem is a small, simple line in your routes.rb file:</p>
<p>[code]devise_for :users[/code]</p>
<p>I came to understand it has something to do with user model class methods and scopes which access the user model itself. When migrating devise scans the user model and tries something ( I regret to say I have no idea what...) but the tableÂ obviously doen't exist yet. The only working solution (pretty ugly but working though) is simply catching any exception generated by the <em>devise_for</em> statement:</p>
<p>[code]<br />
  begin<br />
    devise_for :users<br />
  rescue Exception =&gt; e<br />
    puts &quot;Devise error: #{e.class}: #{e}&quot;<br />
  end<br />
[/code]</p>
<p>If anyone knows the real root of the problem and the ultimate, beautiful solution don't hesitate and provide!</p>
